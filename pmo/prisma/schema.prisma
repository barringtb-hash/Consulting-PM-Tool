generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum CompanySize {
  MICRO
  SMALL
  MEDIUM
}

enum AiMaturity {
  NONE
  LOW
  MEDIUM
  HIGH
}

enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

enum DocumentType {
  REQUIREMENTS
  PROPOSAL
  CONTRACT
  REPORT
  OTHER
}

model User {
  id           Int      @id @default(autoincrement())
  name         String
  email        String   @unique
  passwordHash String
  timezone     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  ownedProjects Project[]
  documents     Document[]
}

model Client {
  id          Int          @id @default(autoincrement())
  name        String
  industry    String?
  companySize CompanySize?
  timezone    String?
  aiMaturity  AiMaturity?
  notes       String?
  archived    Boolean      @default(false)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  contacts  Contact[]
  projects  Project[]
  documents Document[]
}

model Contact {
  id        Int      @id @default(autoincrement())
  clientId  Int
  name      String
  email     String
  role      String?
  phone     String?
  notes     String?
  archived  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  client Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@unique([clientId, email])
}

model Project {
  id        Int           @id @default(autoincrement())
  clientId  Int
  ownerId   Int
  name      String
  status    ProjectStatus @default(PLANNING)
  startDate DateTime?
  endDate   DateTime?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  client    Client     @relation(fields: [clientId], references: [id], onDelete: Cascade)
  owner     User       @relation(fields: [ownerId], references: [id])
  documents Document[]
}

model Document {
  id        Int          @id @default(autoincrement())
  clientId  Int
  projectId Int?
  ownerId   Int
  type      DocumentType @default(OTHER)
  filename  String
  url       String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  client  Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  project Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)
  owner   User     @relation(fields: [ownerId], references: [id])

  @@index([projectId])
}
